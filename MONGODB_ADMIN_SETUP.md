# MongoDB Admin Signup Setup Guide

## Overview
The admin signup system uses the existing **`users`** collection in your MongoDB database. No new collection needs to be created.

## Database Configuration

### Collection Name
- **`users`** (already exists)

### Admin Document Structure
```javascript
{
  _id: ObjectId("..."),           // Auto-generated by MongoDB
  email: "admin@example.com",     // Unique email address
  password: "$2b$12$...",         // Hashed password (bcrypt)
  user_type: "admin",             // String: "admin" or "voter"
  created_at: ISODate("2025-01-05T10:30:00Z"),
  updated_at: ISODate("2025-01-05T10:30:00Z")
}
```

## Existing Indexes

Your MongoDB already has the necessary indexes for the admin signup system:

```javascript
// These indexes are already created (from db_schema.md)

// 1. Unique email index (prevents duplicate registrations)
db.users.createIndex({ email: 1 }, { unique: true })

// 2. User type index (for faster queries by user_type)
db.users.createIndex({ user_type: 1 })

// 3. Created date index (for sorting by creation date)
db.users.createIndex({ created_at: -1 })

// 4. Sparse voter_id index (for voters only)
db.users.createIndex({ voter_id: 1 }, { unique: true, sparse: true })
```

## Verify MongoDB Setup

### Option 1: MongoDB Compass (GUI)
1. Open MongoDB Compass
2. Connect to your MongoDB instance
3. Navigate to: **`voting_system`** → **`users`** collection
4. You should see both voter and admin documents

### Option 2: MongoDB Shell
```javascript
// Connect to MongoDB
mongosh

// Select database
use voting_system

// View all indexes on users collection
db.users.getIndexes()

// Should show:
// {
//   v: 2,
//   key: { _id: 1 }
// },
// {
//   v: 2,
//   key: { email: 1 },
//   unique: true
// },
// {
//   v: 2,
//   key: { voter_id: 1 },
//   unique: true,
//   sparse: true
// },
// {
//   v: 2,
//   key: { user_type: 1 }
// },
// {
//   v: 2,
//   key: { created_at: -1 }
// }
```

## Admin Document Examples

### Example 1: First Admin Account
```javascript
{
  _id: ObjectId("507f1f77bcf86cd799439012"),
  email: "admin@votingsystem.com",
  password: "$2b$12$abcdef1234567890abcdef1234567890abcdef1234567890",
  user_type: "admin",
  created_at: ISODate("2025-01-05T09:00:00Z"),
  updated_at: ISODate("2025-01-05T09:00:00Z")
}
```

### Example 2: Second Admin Account
```javascript
{
  _id: ObjectId("507f1f77bcf86cd799439013"),
  email: "manager@votingsystem.com",
  password: "$2b$12$xyz1234567890xyz1234567890xyz1234567890xyz12345678",
  user_type: "admin",
  created_at: ISODate("2025-01-05T10:15:00Z"),
  updated_at: ISODate("2025-01-05T10:15:00Z")
}
```

## Query Examples

### Find All Admin Accounts
```javascript
use voting_system
db.users.find({ user_type: "admin" })
```

### Find Specific Admin by Email
```javascript
db.users.findOne({ email: "admin@votingsystem.com" })
```

### Count Admin Accounts
```javascript
db.users.countDocuments({ user_type: "admin" })
```

### Find All Voters
```javascript
db.users.find({ user_type: "voter" })
```

### Find All Users (Both Admins and Voters)
```javascript
db.users.find({})
```

### Check if Email is Unique
```javascript
db.users.find({ email: "test@example.com" })
// Should return 0 or 1 result
```

## Admin vs Voter Field Differences

### Admin Account Fields
- **Required:** `email`, `password`, `user_type: "admin"`, `created_at`, `updated_at`
- **Optional:** None (minimal fields)
- **Not Used:** `voter_id`, `full_name`, `phone_no`, `address`, `date_of_birth`, `branch_name`, `photo_url`, `fingerprint_template`, `has_account`

### Voter Account Fields
- **Required:** `voter_id`, `email`, `password`, `user_type: "voter"`, `has_account`, `created_at`, `updated_at`
- **Optional:** `full_name`, `phone_no`, `address`, `date_of_birth`, `branch_name`, `photo_url`, `fingerprint_template`

## Backup & Recovery

### Backup Admin Accounts
```bash
# Export all admin accounts
mongodump --db voting_system --collection users --query '{ "user_type": "admin" }'
```

### Import Admin Accounts
```bash
# Import admin accounts
mongorestore --db voting_system --collection users admin_backup.bson
```

## Troubleshooting

### Issue: "Email already exists" error during signup
**Cause:** The email is already registered as a voter or admin
**Solution:** Use a different email address

### Issue: Admin can't login
**Possible Causes:**
1. Email doesn't exist in database
2. User registered as voter, not admin (check `user_type` field)
3. Password is incorrect
4. Account not created successfully

**Debug Command:**
```javascript
// Check if admin exists
db.users.findOne({ email: "admin@example.com" })

// Verify user_type
db.users.findOne({ email: "admin@example.com" }).user_type
// Should return: "admin"
```

### Issue: Password hash doesn't match
**Cause:** Password validation failed on backend before hashing
**Solution:** Ensure password meets all 5 requirements:
- ✓ Minimum 8 characters
- ✓ One uppercase letter
- ✓ One lowercase letter  
- ✓ One number
- ✓ One special character

## Password Hashing

Passwords are hashed using **Werkzeug's `generate_password_hash()`** function which uses **bcrypt** algorithm:

```python
from werkzeug.security import generate_password_hash, check_password_hash

# Hashing during signup
hashed_pw = generate_password_hash("TestPassword123!")
# Result: "$2b$12$abcdef1234567890abcdef1234567890abcdef1234567890"

# Verifying during login
check_password_hash(hashed_pw, "TestPassword123!")
# Result: True (passwords match)

check_password_hash(hashed_pw, "WrongPassword")
# Result: False (passwords don't match)
```

## Security Notes

✅ **What's Secure:**
- Passwords are hashed with bcrypt (industry standard)
- Email uniqueness is enforced at database level
- No plaintext passwords stored
- Password validation prevents weak passwords

⚠️ **Recommendations:**
- Add email verification before account activation
- Implement login attempt rate limiting
- Add admin approval workflow for new admin registrations
- Enable MongoDB authentication (if not already)
- Use HTTPS in production
- Consider adding 2FA for admin accounts

## No New MongoDB Cluster Needed

Your existing MongoDB setup is sufficient. The admin signup system:
- ✅ Uses existing `users` collection
- ✅ Uses existing indexes
- ✅ No schema migration needed
- ✅ Compatible with existing voter accounts

**You're all set to start using the admin signup system!**
